local _,G,S,V,P,U=nil,game,pairs,Vector3.new,CFrame.new;local R,C,D,T=G:GetService("RunService"),G:GetService("CollectionService"),G:GetService("Debris"),G:GetService("Players");local W=G:GetService("Workspace");local CP=G:GetService("ContentProvider");local f,g,h,i=math.min,math.max,math.floor,math.clamp;local j,k,l,m=os.clock,task.spawn,task.wait,pcall;local n,o=table.insert,table.remove;local Z={};Z.s={[1]={f=60,p_m=1.0,s_m=1.0,r_m=1.0,e_m=1.0,v_m=1.0,ld_m=1.0,ph_m=1.0,ch_m=1.0,ge_m=1.0,mem_m=1.0,st_m=1.0,nr_m=1.0,mod_m=1.0,an_m=1.0,au_m=1.0},[2]={f=45,p_m=0.8,s_m=0.8,r_m=0.8,e_m=0.8,v_m=0.8,ld_m=0.8,ph_m=0.8,ch_m=0.8,ge_m=0.8,mem_m=0.8,st_m=0.8,nr_m=0.8,mod_m=0.8,an_m=0.8,au_m=0.8},[3]={f=30,p_m=0.6,s_m=0.6,r_m=0.6,e_m=0.6,v_m=0.6,ld_m=0.6,ph_m=0.6,ch_m=0.6,ge_m=0.6,mem_m=0.6,st_m=0.6,nr_m=0.6,mod_m=0.6,an_m=0.6,au_m=0.6},t_f=60,e_t=30,r_t=45,s_f=0.05,p_br=300,p_svs=0.0625,p_ui=0.5,s_br=250,s_ui=0.7,r_br=800,rf_dsqr={[1]={100*100,300*300,600*600},[2]={150*150,400*400,800*800},[3]={200*200,500*500,1000*1000}},r_ui=0.12,e_dc={[1]=500,[2]=300,[3]=150},e_fds=100,e_fde=400,e_ui=0.12,gc_s=100,ni_bs=5,cl_bs=10,cl_t=50,scan_int=3,scan_limit=50,auto_p_min_parts=5,auto_r_min_parts=3,auto_s_min_scripts=1,auto_e_min_effects=1,no_min_dist=150,no_max_dist=300,v_dc={[1]=500,[2]=300,[3]=150},v_fds=50,v_fde=300,v_ui=0.1,ld_min_dist=600,ld_max_dist=1200,ld_min_parts=10,ph_idle_v=0.1,ph_idle_t=5,ph_br=100,ch_br=150,ch_rf_dsqr={[1]={50*50,150*150,300*300},[2]={75*75,200*200,400*400},[3]={100*100,250*250,500*500}},ch_an_ds=200,ch_de_ds=100,ge_br=200,ge_lt_mult=0.5,mem_gc_int=60,st_min_tr=64,st_max_tr=2048,st_min_mr=64,st_max_mr=1024,st_ui=1,prld_dist=300,prld_batch=10,mod_br=800,mod_lod_dsqr={[1]={200*200,400*400,600*600},[2]={300*300,600*600,900*900},[3]={400*400,800*800,1200*1200}},an_br=500,an_frq_dsqr={[1]={100*100,200*200,300*300},[2]={150*150,300*300,450*450},[3]={200*200,400*400,600*600}},an_frq_low=0.1,au_br=500,au_vol_dsqr={[1]={50*50,150*150,300*300},[2]={75*75,200*200,400*400},[3]={100*100,250*250,500*500}},au_str_d=600};Z.l={a_f=Z.s.t_f,c_p=Z.s[1],p_m="Normal",l_pc=0,c_pr=Z.s.p_br,c_sr=Z.s.s_br,c_rr=Z.s.r_br,c_er=Z.s.e_dc[1],c_vr=Z.s.v_dc[1],c_ldr=Z.s.ld_min_dist,c_phr=Z.s.ph_br,c_chr=Z.s.ch_br,c_ger=Z.s.ge_br,c_memr=Z.s.mem_gc_int,c_str_tr=Z.s.st_max_tr,c_str_mr=Z.s.st_max_mr,c_modr=Z.s.mod_br,c_anr=Z.s.an_br,c_aur=Z.s.au_br};Z.a={p_p={},sc={},rd={},ef={},g={},niq={},scanned={},no_t={},v_e={},ld_e={},ph_a={},ch_a={},ge_a={},mem_lt=j(),prld_q={},mod_a={},an_a={},au_a={}};local FPCache={};local L_GET_FRUSTUM_PLANES=nil;local function d(t)local r,c,b={},string.char,bit32.bxor;for _,v in P(t)do n(r,c(b(v,17)))end;return table.concat(r)end;local function E(t)local u=Z.s.gc_s;return h(t.X/u).."_"..h(t.Y/u).."_"..h(t.Z/u)end;local function F(t,u)local v=E(t.Position);if not Z.a.g[v]then Z.a.g[v]={}end;n(Z.a.g[v],t);u.v=v end;local function H(t,u)local v=u.v;if v and Z.a.g[v]then for x=#Z.a.g[v],1,-1 do if Z.a.g[v][x]==t then o(Z.a.g[v],x)break end end;if #Z.a.g[v]==0 then Z.a.g[v]=nil end;u.v=nil end end;local function cV(p,bS)if not L_GET_FRUSTUM_PLANES then return true end;local Cam=W.CurrentCamera;if not Cam then L_GET_FRUSTUM_PLANES=nil;return true end;FPCache=Cam:GetFrustumPlanes();local bP=p.Position;for x=1,6 do local pl=FPCache[x];local d=pl.Normal:Dot(bP)-pl.Offset;local r=bS.X*math.abs(pl.Normal.X)+bS.Y*math.abs(pl.Normal.Y)+bS.Z*math.abs(pl.Normal.Z);if d<-r then return false end end;return true end;function Z.l:f(d)if d==0 or d>1 then return end;local p=Z.s.s_f;self.a_f=p*(1/d)+(1-p)*self.a_f;if self.p_m=="Normal"then if self.a_f<Z.s.e_t then self.p_m="Emergency"end elseif self.p_m=="Emergency"then if self.a_f>Z.s.r_t then self.p_m="Recovery"end elseif self.p_m=="Recovery"then if self.a_f<Z.s.e_t then self.p_m="Emergency"elseif self.a_f>Z.s.t_f*0.9 then self.p_m="Normal"end end;local q=Z.s[1];if self.p_m=="Emergency"then q=Z.s[3]elseif self.p_m=="Recovery"then q=Z.s[2]else if self.a_f<Z.s[2].f then q=Z.s[3]elseif self.a_f<Z.s[1].f then q=Z.s[2]else q=Z.s[1]end end;self.c_p=q;self.c_pr=Z.s.p_br*q.p_m;self.c_sr=Z.s.s_br*q.s_m;self.c_rr=Z.s.r_br*q.r_m;self.c_er=Z.s.e_dc[i(3*q.e_m+0.5)]or Z.s.e_dc[1];self.c_vr=Z.s.v_dc[i(3*q.v_m+0.5)]or Z.s.v_dc[1];self.c_ldr=Z.s.ld_min_dist*q.ld_m;self.c_phr=Z.s.ph_br*q.ph_m;self.c_chr=Z.s.ch_br*q.ch_m;self.c_ger=Z.s.ge_br*q.ge_m;self.c_memr=Z.s.mem_gc_int*q.mem_m;self.c_str_tr=Z.s.st_min_tr+(Z.s.st_max_tr-Z.s.st_min_tr)*q.st_m;self.c_str_mr=Z.s.st_min_mr+(Z.s.st_max_mr-Z.s.st_min_mr)*q.st_m;self.c_modr=Z.s.mod_br*q.mod_m;self.c_anr=Z.s.an_br*q.an_m;self.c_aur=Z.s.au_br*q.au_m end;function Z.l:h(t)local u=Z.a.p_p,v=Z.s.p_svs,w=self.c_pr;local C=J(t,w);local D={};for _,x in P(C)do if x and x.Parent and x:IsA("BasePart")and not x.Anchored then local y=(x.Position-t).MagnitudeSqr;local z=y>(w*w)or x.AssemblyLinearVelocity.MagnitudeSqr<v;if x.Anchored~=z then x.Anchored=z;if z then x:SetNetworkOwner(nil)else x:SetNetworkOwner(T.LocalPlayer)end end;D[x]=true end end;for x,y in P(u)do if not D[x]then if x and x.Parent and x:IsA("BasePart")and x.Anchored then local z=(x.Position-t).MagnitudeSqr;if z<=(w*w)and x.AssemblyLinearVelocity.MagnitudeSqr>=v then x.Anchored=false;x:SetNetworkOwner(T.LocalPlayer)end end end end end;function Z.l:i(t)local u=Z.a.sc,v=self.c_sr;local w=v*v;for x=#u,1,-1 do local y=u[x];local z=y.z;if not y.y or not y.y.Parent or not z or not z.Parent then o(u,x);continue end;local A=(z.Position-t).MagnitudeSqr;local B=A>w;if y.y.Disabled~=B then y.y.Disabled=B end end end;function Z.l:r(t)local u=Z.a.rd;local v=self.c_rr;local w=Z.s.rf_dsqr[i(3*(self.c_p.r_m or 1)+0.5)]or Z.s.rf_dsqr[1];for x=#u,1,-1 do local y=u[x];local z=y.z;if not y.y or not y.y.Parent or not z or not z.Parent then o(u,x);continue end;local A=(z.Position-t).MagnitudeSqr;local B=cV(z,y.bS);local C=2;if B then if A<w[1]then C=0 elseif A<w[2]then C=1 elseif A<w[3]then C=2 end else C=2 end;if y.rf~=C then y.rf=C;for _,p in P(y.p)do p.RenderFidelity=Enum.RenderFidelity.FromValue(C)end end end end;function Z.l:e(t)local u=Z.a.ef;local v=self.c_er*self.c_er;local fds=Z.s.e_fds;local fde=Z.s.e_fde;local fds_sq=fds*fds;local fde_sq=fde*fde;for x=#u,1,-1 do local y=u[x];local e=y.e;local aP=y.a;if not e or not e.Parent or not aP or not aP.Parent then o(u,x);continue end;local dSqr_effect=(aP.Position-t).MagnitudeSqr;local targetEnabled=cV(aP,aP.Size)and dSqr_effect<v;local fadeFactor=1;if dSqr_effect>fds_sq then fadeFactor=1-i((dSqr_effect-fds_sq)/(fde_sq-fds_sq),0,1)end;local enabled=targetEnabled and fadeFactor>0.01;if e:IsA("ParticleEmitter")then e.Rate=y.o.Rate*fadeFactor elseif e:IsA("Light")then e.Brightness=y.o.Brightness*fadeFactor elseif e:IsA("Beam")then e.Width0=y.o.Width0;e.Width1=y.o.Width1*fadeFactor elseif e:IsA("Trail")then e.Lifetime=y.o.Lifetime*fadeFactor end;if e.Enabled~=enabled then e.Enabled=enabled end end end;function Z.l:no(t)local u=Z.a.no_t;local minD=Z.s.no_min_dist;local maxD=Z.s.no_max_dist;for x=#u,1,-1 do local p=u[x];if not p or not p.Parent or not p:IsA("BasePart")then o(u,x);continue end;local dist=(p.Position-t).Magnitude;local currentOwner=p.NetworkOwner;if dist>maxD and currentOwner~=nil then p:SetNetworkOwner(nil)elseif dist<minD and currentOwner~=T.LocalPlayer then p:SetNetworkOwner(T.LocalPlayer)end end end;function Z.l:v(t)local u=Z.a.v_e;local v_r=self.c_vr*self.c_vr;local v_fds=Z.s.v_fds;local v_fde=Z.s.v_fde;local v_fds_sq=v_fds*v_fds;local v_fde_sq=v_fde*v_fde;for x=#u,1,-1 do local y=u[x];local inst=y.i;local pPart=y.p;if not inst or not inst.Parent or not pPart or not pPart.Parent then o(u,x);continue end;local dSqr=(pPart.Position-t).MagnitudeSqr;local targetVisible=cV(pPart,pPart.Size)and dSqr<v_r;local fadeFactor=1;if dSqr>v_fds_sq then fadeFactor=1-i((dSqr-v_fds_sq)/(v_fde_sq-v_fds_sq),0,1)end;local visible=targetVisible and fadeFactor>0.01;if inst:IsA("BillboardGui")or inst:IsA("SurfaceGui")then if inst.Enabled~=visible then inst.Enabled=visible end elseif inst:IsA("Decal")or inst:IsA("Texture")then if visible then inst.Transparency=y.o.Transparency else inst.Transparency=1 end end end end;local _unloadedObjects={};function Z.l:ld(t)local minD=self.c_ldr;local maxD=Z.s.ld_max_dist;local lp=T.LocalPlayer.Character and T.LocalPlayer.Character.PrimaryPart and T.LocalPlayer.Character.PrimaryPart.Position;if not lp then return end;for x=#Z.a.ld_e,1,-1 do local item=Z.a.ld_e[x];local model=item.m;local pp=item.p;if not model or not pp or not pp.Parent then o(Z.a.ld_e,x);_unloadedObjects[model]=nil;continue end;local dist=(pp.Position-lp).Magnitude;if dist>maxD and model.Parent~=nil then _unloadedObjects[model]=model.Parent; model.Parent=nil elseif dist<minD and model.Parent==nil and _unloadedObjects[model]then model.Parent=_unloadedObjects[model]; _unloadedObjects[model]=nil end end end;function Z.l:ph(t)local u=Z.a.ph_a;local r_sq=self.c_phr*self.c_phr;local idle_v_sq=Z.s.ph_idle_v*Z.s.ph_idle_v;local idle_t=Z.s.ph_idle_t;local now=j();for x=#u,1,-1 do local item=u[x];local part=item.p;if not part or not part.Parent or not part:IsA("BasePart")or part.Anchored then o(u,x);continue end;local dist_sq=(part.Position-t).MagnitudeSqr;local is_far=dist_sq>r_sq;local is_idle=part.AssemblyLinearVelocity.MagnitudeSqr<idle_v_sq and part.AssemblyAngularVelocity.MagnitudeSqr<idle_v_sq;if is_far and is_idle then if not item.idle_since then item.idle_since=now end;if now-item.idle_since>idle_t then if not item.optimized then part.CustomPhysicalProperties=PhysicalProperties.new(0.001,0.001,0.001,0.001,0.001);item.optimized=true end end else if item.optimized then part.CustomPhysicalProperties=item.orig_props;item.optimized=false end;item.idle_since=nil end end end;function Z.l:ch(t)local u=Z.a.ch_a;local r_sq=self.c_chr*self.c_chr;local rf_dsqr=Z.s.ch_rf_dsqr[i(3*(self.c_p.ch_m or 1)+0.5)]or Z.s.ch_rf_dsqr[1];local an_ds_sq=Z.s.ch_an_ds*Z.s.ch_an_ds;
local de_ds_sq=Z.s.ch_de_ds*Z.s.ch_de_ds;
for x=#u,1,-1 do local item=u[x];local char=item.c;local hrp=item.h;if not char or not char.Parent or not hrp or not hrp.Parent then o(u,x);continue end;local dist_sq=(hrp.Position-t).MagnitudeSqr;local in_frustum=cV(hrp,hrp.Size);local is_far=dist_sq>r_sq;local target_rf=2;local target_anim=true;local target_decal=true;if in_frustum then if dist_sq<rf_dsqr[1]then target_rf=0 elseif dist_sq<rf_dsqr[2]then target_rf=1 else target_rf=2 end;if dist_sq>an_ds_sq then target_anim=false end;if dist_sq>de_ds_sq then target_decal=false end else target_rf=2;target_anim=false;target_decal=false end;for _,part in P(char:GetChildren())do if part:IsA("BasePart")then if part.RenderFidelity~=Enum.RenderFidelity.FromValue(target_rf)then part.RenderFidelity=Enum.RenderFidelity.FromValue(target_rf)end end;for _,decal in P(part:GetChildren())do if decal:IsA("Decal")or decal:IsA("Texture")then if target_decal then if decal.Transparency~=item.orig_decal_t[decal]then decal.Transparency=item.orig_decal_t[decal]end else if decal.Transparency~=1 then decal.Transparency=1 end end end end end;for _,anim in P(item.anims)do if anim.IsPlaying and not target_anim then anim:Stop()elseif not anim.IsPlaying and target_anim then anim:Play()end end end end;function Z.l:ge(t)local u=Z.a.ge_a;local r_sq=self.c_ger*self.c_ger;local lt_mult=Z.s.ge_lt_mult;for x=#u,1,-1 do local item=u[x];local effect=item.e;local p_part=item.p;if not effect or not effect.Parent or not p_part or not p_part.Parent then o(u,x);continue end;local dist_sq=(p_part.Position-t).MagnitudeSqr;local in_frustum=cV(p_part,p_part.Size);local is_far=dist_sq>r_sq;if is_far and not in_frustum then if effect:IsA("ParticleEmitter")then effect.Lifetime=item.orig_lt*lt_mult elseif effect:IsA("Trail")then effect.Lifetime=item.orig_lt*lt_mult elseif effect:IsA("Beam")then D:AddItem(effect,0)else D:AddItem(effect,0)end end end end;function Z.l:mod(t)local u=Z.a.mod_a;local r_sq=self.c_modr*self.c_modr;local lod_dsqr=Z.s.mod_lod_dsqr[i(3*(self.c_p.mod_m or 1)+0.5)]or Z.s.mod_lod_dsqr[1];for x=#u,1,-1 do local item=u[x];local model=item.m;local pp=item.p;if not model or not model.Parent or not pp or not pp.Parent then o(u,x);continue end;local dist_sq=(pp.Position-t).MagnitudeSqr;local in_frustum=cV(pp,pp.Size);local target_level=3;if in_frustum then if dist_sq<lod_dsqr[1]then target_level=0 elseif dist_sq<lod_dsqr[2]then target_level=1 elseif dist_sq<lod_dsqr[3]then target_level=2 else target_level=3 end else target_level=3 end;if item.current_lod~=target_level then item.current_lod=target_level;if target_level==0 then for _,p in P(model:GetDescendants())do if p:IsA("BasePart")then p.RenderFidelity=Enum.RenderFidelity.Precise end end elseif target_level==1 then for _,p in P(model:GetDescendants())do if p:IsA("BasePart")then p.RenderFidelity=Enum.RenderFidelity.PerformsObject end end elseif target_level==2 then for _,p in P(model:GetDescendants())do if p:IsA("BasePart")then p.RenderFidelity=Enum.RenderFidelity.Box end end elseif target_level==3 then for _,p in P(model:GetDescendants())do if p:IsA("BasePart")then p.Transparency=1; p.RenderFidelity=Enum.RenderFidelity.Box end end end end end end end;function Z.l:an(t)local u=Z.a.an_a;local r_sq=self.c_anr*self.c_anr;local frq_dsqr=Z.s.an_frq_dsqr[i(3*(self.c_p.an_m or 1)+0.5)]or Z.s.an_frq_dsqr[1];local low_frq_mult=Z.s.an_frq_low;for x=#u,1,-1 do local item=u[x];local char_or_anim=item.i;local pp=item.p;if not char_or_anim or not char_or_anim.Parent or not pp or not pp.Parent then o(u,x);continue end;local dist_sq=(pp.Position-t).MagnitudeSqr;local in_frustum=cV(pp,pp.Size);local target_freq=1;if in_frustum then if dist_sq>frq_dsqr[1]and dist_sq<frq_dsqr[2]then target_freq=0.5 elseif dist_sq>=frq_dsqr[2]and dist_sq<frq_dsqr[3]then target_freq=0.25 elseif dist_sq>=frq_dsqr[3]then target_freq=low_frq_mult end else target_freq=low_frq_mult end;if char_or_anim:IsA("Humanoid")then if item.current_an_frq~=target_freq then item.current_an_frq=target_freq;for _,track in P(char_or_anim:GetPlayingAnimationTracks())do track.TimeScale=target_freq end end elseif char_or_anim:IsA("AnimationController")then if item.current_an_frq~=target_freq then item.current_an_frq=target_freq;for _,track in P(char_or_anim:GetPlayingAnimationTracks())do track.TimeScale=target_freq end end end end end;function Z.l:au(t)local u=Z.a.au_a;local r_sq=self.c_aur*self.c_aur;local vol_dsqr=Z.s.au_vol_dsqr[i(3*(self.c_p.au_m or 1)+0.5)]or Z.s.au_vol_dsqr[1];local str_dist=Z.s.au_str_d;local lp=T.LocalPlayer.Character and T.LocalPlayer.Character.PrimaryPart and T.LocalPlayer.Character.PrimaryPart.Position;if not lp then return end;for x=#u,1,-1 do local item=u[x];local sound=item.s;local pp=item.p;if not sound or not sound.Parent or not pp or not pp.Parent then o(u,x);continue end;local dist_sq=(pp.Position-t).MagnitudeSqr;local in_frustum=cV(pp,pp.Size);local target_volume=item.orig_vol;local enabled=true;if dist_sq>r_sq or not in_frustum then enabled=false end;if dist_sq>vol_dsqr[1]then target_volume=item.orig_vol*0.75 elseif dist_sq>vol_dsqr[2]then target_volume=item.orig_vol*0.5 elseif dist_sq>vol_dsqr[3]then target_volume=item.orig_vol*0.25 end;if sound.IsPlaying and not enabled then sound:Stop()elseif not sound.IsPlaying and enabled and sound.TimePosition==0 then sound:Play()end;sound.Volume=target_volume;if dist_sq>str_dist*str_dist and sound.IsLoaded then sound:Stop();sound:Play(0.001)end;end end;local _scanQueue={};local _scanIndex=1;local _workspaceChildren={};local scanCompleted=true;function Z.l:j()local u=0;local v=Z.s.ni_bs;local scanned=Z.a.scanned;while #_scanQueue>0 and u<v do local w=o(_scanQueue,1);if not w or not w.Parent or not w:IsDescendantOf(G)or scanned[w]then goto C end;scanned[w]=true;local parts_count=0;local scripts_count=0;local effects_count=0;local primary_part=nil;local visual_elements_found=0;local has_animations=false;local is_character_model=w:IsA("Model")and w:FindFirstChildOfClass("Humanoid")and w:FindFirstChild("HumanoidRootPart");local has_physics=false;local has_sounds=false;if w:IsA("BasePart")then parts_count=1;primary_part=w;has_physics=true elseif w:IsA("Model")then for _,y in P(w:GetDescendants())do if y:IsA("BasePart")then parts_count+=1;if not primary_part and y:IsA("BasePart")and not y.Anchored then primary_part=y end;has_physics=true elseif y:IsA("Script")or y:IsA("LocalScript")then scripts_count+=1 elseif y:IsA("ParticleEmitter")or y:IsA("Beam")or y:IsA("Trail")or y:IsA("Light")then effects_count+=1 elseif y:IsA("BillboardGui")or y:IsA("SurfaceGui")or y:IsA("Decal")or y:IsA("Texture")then visual_elements_found+=1 elseif y:IsA("AnimationController")or y:IsA("Motor6D")then has_animations=true elseif y:IsA("Sound")then has_sounds=true end end;if not primary_part and w.PrimaryPart then primary_part=w.PrimaryPart end end;if parts_count>=Z.s.auto_p_min_parts then local x={};if w:IsA("BasePart")then n(x,w)elseif w:IsA("Model")then for _,y in P(w:GetDescendants())do if y:IsA("BasePart")and not y.Anchored then n(x,y)end end end;for _,y in P(x)do if not Z.a.p_p[y]then local z={y=y};Z.a.p_p[y]=z;F(y,z);y.Destroying:Connect(function()H(y,z);Z.a.p_p[y]=nil end)end end end;if scripts_count>=Z.s.auto_s_min_scripts and primary_part then local x={};if w:IsA("Script")or w:IsA("LocalScript")then n(x,w)else for _,y in P(w:GetDescendants())do if y:IsA("Script")or y:IsA("LocalScript")then n(x,y)end end end;for _,y in P(x)do if not Z.a.sc[y]then local B={y=y,z=primary_part};n(Z.a.sc,B);y.Destroying:Connect(function()for x=#Z.a.sc,1,-1 do if Z.a.sc[x].y==y then o(Z.a.sc,x)break end end end)end end end;if parts_count>=Z.s.auto_r_min_parts and primary_part and w:IsA("Model")then local x={};local bS=w:GetBoundingBox().Size;for _,y in P(w:GetDescendants())do if y:IsA("BasePart")then n(x,y)end end;local y={y=w,z=primary_part,p=x,bS=bS,rf=2};n(Z.a.rd,y);w.Destroying:Connect(function()for z=#Z.a.rd,1,-1 do if Z.a.rd[z].y==w then o(Z.a.rd,z)break end end end)end end;if effects_count>=Z.s.auto_e_min_effects then local function x(e)local y=e:IsA("BasePart")and e or e:FindFirstAncestorWhichIsA("Model")and e:FindFirstAncestorWhichIsA("Model").PrimaryPart;if not y then return end;local z={e=e,a=y,o={},c={}};if e:IsA("ParticleEmitter")then z.o.Rate=e.Rate;z.c.Rate=e.Rate elseif e:IsA("Light")then z.o.Brightness=e.Brightness;z.c.Brightness=e.Brightness elseif e:IsA("Beam")then z.o.Width0=e.Width0;z.o.Width1=e.Width1;z.c.Width0=e.Width0;z.c.Width1=e.Width1 elseif e:IsA("Trail")then z.o.Lifetime=e.Lifetime;z.c.Lifetime=e.Lifetime end;n(Z.a.ef,z);e.Destroying:Connect(function()for A=#Z.a.ef,1,-1 do if Z.a.ef[A].e==e then o(Z.a.ef,A)break end end end)end;if w:IsA("ParticleEmitter")or w:IsA("Beam")or w:IsA("Trail")or w:IsA("Light")then x(w)else for _,y in P(w:GetDescendants())do if y:IsA("ParticleEmitter")or y:IsA("Beam")or y:IsA("Trail")or y:IsA("Light")then x(y)end end end end;if w:IsA("BasePart")and not w.Anchored then n(Z.a.no_t,w)end;if visual_elements_found>0 or w:IsA("BillboardGui")or w:IsA("SurfaceGui")or w:IsA("Decal")or w:IsA("Texture")then local function v(inst,parent_part)local orig_val={};if inst:IsA("BillboardGui")or inst:IsA("SurfaceGui")then orig_val.Enabled=inst.Enabled elseif inst:IsA("Decal")or inst:IsA("Texture")then orig_val.Transparency=inst.Transparency end;local item={i=inst,p=parent_part,o=orig_val};n(Z.a.v_e,item);inst.Destroying:Connect(function()for q=#Z.a.v_e,1,-1 do if Z.a.v_e[q].i==inst then o(Z.a.v_e,q)break end end end)end;if w:IsA("BillboardGui")or w:IsA("SurfaceGui")or w:IsA("Decal")or w:IsA("Texture")then if w.Parent and w.Parent:IsA("BasePart")then v(w,w.Parent)end else for _,y in P(w:GetDescendants())do if(y:IsA("BillboardGui")or y:IsA("SurfaceGui")or y:IsA("Decal")or y:IsA("Texture"))and y.Parent and y.Parent:IsA("BasePart")then v(y,y.Parent)end end end end;if w:IsA("Model")and parts_count>=Z.s.ld_min_parts and primary_part then local item={m=w,p=primary_part};n(Z.a.ld_e,item);w.Destroying:Connect(function()for q=#Z.a.ld_e,1,-1 do if Z.a.ld_e[q].m==w then o(Z.a.ld_e,q);_unloadedObjects[w]=nil;break end end end)end;if has_physics and primary_part and not primary_part.Anchored then local orig_props=primary_part.CustomPhysicalProperties or PhysicalProperties.new();local item={p=primary_part,orig_props=orig_props};n(Z.a.ph_a,item);primary_part.Destroying:Connect(function()for q=#Z.a.ph_a,1,-1 do if Z.a.ph_a[q].p==primary_part then o(Z.a.ph_a,q)break end end end)end;if is_character_model then local hrp=w.HumanoidRootPart;local orig_decals={};for _,decal in P(w:GetDescendants())do if decal:IsA("Decal")or decal:IsA("Texture")then orig_decals[decal]=decal.Transparency end end;local anims={};local humanoid=w:FindFirstChildOfClass("Humanoid");if humanoid then for _,t in P(humanoid:GetPlayingAnimationTracks())do n(anims,t)end end;local item={c=w,h=hrp,orig_decal_t=orig_decals,anims=anims};n(Z.a.ch_a,item);w.Destroying:Connect(function()for q=#Z.a.ch_a,1,-1 do if Z.a.ch_a[q].c==w then o(Z.a.ch_a,q)break end end end)end;if effects_count>0 and primary_part then for _,y in P(w:GetDescendants())do if(y:IsA("ParticleEmitter")or y:IsA("Beam")or y:IsA("Trail")or y:IsA("Light"))then local orig_lt=y.Lifetime;if y:IsA("ParticleEmitter")then orig_lt=y.Lifetime end;local item={e=y,p=primary_part,orig_lt=orig_lt};n(Z.a.ge_a,item);y.Destroying:Connect(function()for q=#Z.a.ge_a,1,-1 do if Z.a.ge_a[q].e==y then o(Z.a.ge_a,q)break end end end)end end end;if w:IsA("Model")and primary_part then local item={m=w,p=primary_part,current_lod=0};n(Z.a.mod_a,item);w.Destroying:Connect(function()for q=#Z.a.mod_a,1,-1 do if Z.a.mod_a[q].m==w then o(Z.a.mod_a,q)break end end end)end;if has_animations and primary_part then local item={i=w:IsA("Humanoid")and w or w:FindFirstChildOfClass("AnimationController")or w,p=primary_part,current_an_frq=1};n(Z.a.an_a,item);w.Destroying:Connect(function()for q=#Z.a.an_a,1,-1 do if Z.a.an_a[q].i==w then o(Z.a.an_a,q)break end end end)end;if has_sounds and primary_part then for _,sound in P(w:GetDescendants())do if sound:IsA("Sound")then local item={s=sound,p=primary_part,orig_vol=sound.Volume};n(Z.a.au_a,item);sound.Destroying:Connect(function()for q=#Z.a.au_a,1,-1 do if Z.a.au_a[q].s==sound then o(Z.a.au_a,q)break end end end)end end end;local assets_to_preload={};for _,descendant in P(w:GetDescendants())do if descendant:IsA("DataModelMesh")or descendant:IsA("Texture")or descendant:IsA("Sound")or descendant:IsA("Animation")then n(assets_to_preload,descendant.ContentId or descendant.TextureId or descendant.SoundId)end end;for _,asset_id in P(assets_to_preload)do if asset_id~=""then n(Z.a.prld_q,asset_id)end end;u+=1;::C:: end end;function Z.l:m()if scanCompleted then _workspaceChildren={};for _,c in P(W:GetChildren())do if not Z.a.scanned[c]then n(_workspaceChildren,c)end end;_scanIndex=1;scanCompleted=false end;local scanned_count=0;while _scanIndex<=#_workspaceChildren and scanned_count<Z.s.scan_limit do local inst=_workspaceChildren[_scanIndex];if inst and not Z.a.scanned[inst]then n(_scanQueue,inst)end;_scanIndex+=1;scanned_count+=1 end;if _scanIndex>#_workspaceChildren then scanCompleted=true end end;local Q={function()local u=0,v=Z.a.p_p;for w,x in P(v)do if not w or not w.Parent then H(w,x);Z.a.scanned[w]=nil;v[w]=nil;u+=1 end end;return u end,function()local u=0,v=Z.a.sc;for w=#v,1,-1 do local x=v[w];if not x.y or not x.y.Parent then Z.a.scanned[x.y]=nil;o(v,w);u+=1 end end;return u end,function()local u=0,v=Z.a.rd;for w=#v,1,-1 do local x=v[w];if not x.y or not x.y.Parent then Z.a.scanned[x.y]=nil;o(v,w);u+=1 end end;return u end,function()local u=0,v=Z.a.ef;for w=#v,1,-1 do local x=v[w];if not x.e or not x.e.Parent then Z.a.scanned[x.e]=nil;o(v,w);u+=1 end end;return u end,function()local u=0,v=Z.a.no_t;for w=#v,1,-1 do local x=v[w];if not x or not x.Parent then o(v,w);u+=1 end end;return u end,function()local u=0,v=Z.a.v_e;for w=#v,1,-1 do local x=v[w];if not x.i or not x.i.Parent or not x.p or not x.p.Parent then o(v,w);u+=1 end end;return u end,function()local u=0,v=Z.a.ld_e;for w=#v,1,-1 do local x=v[w];if not x.m or not x.p or not x.p.Parent then o(v,w);_unloadedObjects[x.m]=nil;u+=1 end end;return u end,function()local u=0,v=Z.a.ph_a;for w=#v,1,-1 do local x=v[w];if not x.p or not x.p.Parent then o(v,w);u+=1 end end;return u end,function()local u=0,v=Z.a.ch_a;for w=#v,1,-1 do local x=v[w];if not x.c or not x.c.Parent or not x.h or not x.h.Parent then o(v,w);u+=1 end end;return u end,function()local u=0,v=Z.a.ge_a;for w=#v,1,-1 do local x=v[w];if not x.e or not x.e.Parent or not x.p or not x.p.Parent then o(v,w);u+=1 end end;return u end,function()local u=0,v=Z.a.mod_a;for w=#v,1,-1 do local x=v[w];if not x.m or not x.m.Parent or not x.p or not x.p.Parent then o(v,w);u+=1 end end;return u end,function()local u=0,v=Z.a.an_a;for w=#v,1,-1 do local x=v[w];if not x.i or not x.i.Parent or not x.p or not x.p.Parent then o(v,w);u+=1 end end;return u end,function()local u=0,v=Z.a.au_a;for w=#v,1,-1 do local x=v[w];if not x.s or not x.s.Parent or not x.p or not x.p.Parent then o(v,w);u+=1 end end;return u end,};local M=1;function Z.l:k()local u=Q[M];if not u then return end;u();M+=1;if M>#Q then M=1 end end;function Z.l:mem()local now=j();if now-Z.a.mem_lt>=self.c_memr then collectgarbage("collect");Z.a.mem_lt=now end end;function Z.l:st()local tr=self.c_str_tr;local mr=self.c_str_mr;if W.StreamingEnabled then W.StreamingTargetRadius=tr;W.StreamingMinRadius=mr end;local assets_to_preload={};local lp=T.LocalPlayer.Character and T.LocalPlayer.Character.PrimaryPart and T.LocalPlayer.Character.PrimaryPart.Position;if lp then local parts_in_range=J(lp,Z.s.prld_dist);for _,part in P(parts_in_range)do for _,descendant in P(part:GetDescendants())do if descendant:IsA("DataModelMesh")or descendant:IsA("Texture")or descendant:IsA("Sound")or descendant:IsA("Animation")then local id=descendant.ContentId or descendant.TextureId or descendant.SoundId;if id and id~=""then n(assets_to_preload,id)end end end end end;local batch_size=Z.s.prld_batch;local preloaded_count=0;while #assets_to_preload>0 and preloaded_count<batch_size do local id=o(assets_to_preload,1);local success,err=m(CP.PreloadAsync,CP,{id});if not success then end;preloaded_count+=1 end end;function Z.a()L_GET_FRUSTUM_PLANES=W.CurrentCamera and W.CurrentCamera.GetFrustumPlanes;T.LocalPlayer.CharacterAdded:Connect(function(char)W.CurrentCamera=W.CurrentCamera or char:WaitForChild("Humanoid").Camera;if not L_GET_FRUSTUM_PLANES and W.CurrentCamera then L_GET_FRUSTUM_PLANES=W.CurrentCamera.GetFrustumPlanes end end);if W.CurrentCamera then L_GET_FRUSTUM_PLANES=W.CurrentCamera.GetFrustumPlanes end;W:GetPropertyChangedSignal("CurrentCamera"):Connect(function()L_GET_FRUSTUM_PLANES=W.CurrentCamera and W.CurrentCamera.GetFrustumPlanes end);local t=j();R.Heartbeat:Connect(function(u)local v=j();local w=v-t;t=v;Z.l:f(w)end);l(function()while true do if W.CurrentCamera and T.LocalPlayer and T.LocalPlayer.Character and T.LocalPlayer.Character.PrimaryPart then local u=W.CurrentCamera.CFrame.Position;Z.l:h(u);Z.l:i(u);Z.l:r(u);Z.l:e(u);Z.l:no(u);Z.l:v(u);Z.l:ld(u);Z.l:ph(u);Z.l:ch(u);Z.l:ge(u);Z.l:mod(u);Z.l:an(u);Z.l:au(u)end;Z.l:j();m(Z.s.r_ui)end end);l(function()while true do Z.l:m();m(Z.s.scan_int/(W:GetNumberOfChildren()/Z.s.scan_limit+1))end end);l(function()while true do Z.l:k();Z.l:mem();Z.l:st();m(2)end end)end;Z.a();
